import java.net.*;
import java.io.*;

public class Iperfer {

	// Main Control
	public static void main(String args[]) {
		

		if (!(args.length > 0)) {
			usage(1);
		}

		String check = args[0];
		// CLIENT INSTANCE 
		if (check.equals("-c")){			
			String addr = args[2];
			int port = Integer.parseInt(args[4]);
			int time = Integer.parseInt(args[6]);
			if (!(port >= 1024 && port <= 65535)){
				usage(2);
			}
			iperfer_client client = null;
			try {
				client = new iperfer_client(port, time, addr);
			} catch (IOException e) {
				e.printStackTrace();
			}
			client.send_data();
		// SERVER INSTANCE
		} else if (check.equals("-s")){
			int port = Integer.parseInt(args[2]);
			if (!(port >= 1024 && port <= 65535)){
				usage(2);
			}
			iperfer_server server = null;
			try {
				server = new iperfer_server(port);
				server.listen();
			} catch (IOException e) {
				e.printStackTrace();
			}
		} else {
			usage(1);
		}
	}

	private static void usage(int code) {
		if (code == 1){
			System.err.println("Error: missing or additional arguments");
			System.exit(1);
		} else if (code == 2) {
			System.err.println("Error: port number must be in the range 1024 to 65535");
			System.exit(1);
		}
	}
}
